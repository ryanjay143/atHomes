import{j as e,B as D,F as C,f as H,r as b,Y as M,e as O,c as E,S as F}from"./index-y9SfRuAX.js";import{S as L,a as B,b as U,c as Y,d as h}from"./select-C8QX4jmx.js";import{I as w}from"./input-CFlGoiDJ.js";import{f as q,a as z,b as S,c as f,d as Q,e as c}from"./table-C7jiq5WL.js";import{a as G,f as J}from"./dateUtils-D6w6W0GJ.js";import{D as R,a as $,b as k,c as P,d as I,g as V,f as K,e as W}from"./dialog-C-lhfz2Q.js";import{L as v}from"./label-uwgxVX34.js";function X({unlicensed:r}){var n,o,d,s,x,l;return e.jsxs(R,{children:[e.jsx($,{children:e.jsx(D,{className:"w-8 h-8 rounded-md",children:e.jsx(C,{icon:H,className:"text-[#eff6ff]"})})}),e.jsx(k,{className:"md:max-w-[400px]",children:e.jsxs(P,{children:[e.jsx(I,{className:"text-start",children:"Agent and Broker Details"}),e.jsx(V,{children:e.jsxs("div",{className:"flex flex-col gap-4 mt-5 mb-5",children:[e.jsxs("div",{className:"border-b pb-2 mb-4 text-start",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Personal Details"}),e.jsxs("p",{children:["Name: ",(n=r==null?void 0:r.personal_info)==null?void 0:n.first_name," ",(o=r==null?void 0:r.personal_info)==null?void 0:o.middle_name," ",(d=r==null?void 0:r.personal_info)==null?void 0:d.last_name]}),e.jsxs("p",{children:["Email: ",(s=r==null?void 0:r.user)==null?void 0:s.email]}),e.jsxs("p",{children:["Username: ",(x=r==null?void 0:r.user)==null?void 0:x.username]}),e.jsxs("p",{children:["Phone: ",(l=r==null?void 0:r.personal_info)==null?void 0:l.phone]}),e.jsxs("p",{children:["Gender: ",r.personal_info.gender.charAt(0).toUpperCase()+r.personal_info.gender.slice(1)]}),e.jsxs("p",{children:["Complete Address: ",r.personal_info.complete_address]}),e.jsxs("p",{children:["Status: ",r.user.status===0?"Approved":r.user.status===1?"Pending":"Decline"]})]}),e.jsxs("div",{className:"text-start",children:[e.jsx("h2",{className:"text-lg font-bold ",children:"Identity Information"}),e.jsxs("p",{children:["PRC License Number: ",(r==null?void 0:r.prc_liscence_number)||"N/A"]}),e.jsxs("p",{children:["DHSUD Registration Number: ",(r==null?void 0:r.dhsud_registration_number)||"N/A"]}),e.jsxs("p",{children:["Type: ",(r==null?void 0:r.user.role)===1?"Agent":(r==null?void 0:r.user.role)===2?"Broker":"N/A"]}),e.jsxs("p",{children:["Validity Date: ",G((r==null?void 0:r.validation_date)||"N/A")]})]})]})}),e.jsx(K,{asChild:!0,children:e.jsx(D,{className:"bg-red-500 hover:bg-red-400",children:"Close"})})]})})]})}function Z(r){const[n,o,d]=r.split("-");return`${d}-${o}-${n}`}function ee({unlicensed:r,agentUnliscenced:n}){var a,_,p,m;const[o,d]=b.useState(!1),[s,x]=b.useState({prc_liscence_number:"",dhsud_registration_number:"",validation_date:r.validation_date?Z(r.validation_date):"",role:((_=(a=r.user)==null?void 0:a.role)==null?void 0:_.toString())||"1"}),[l,u]=b.useState({prc_liscence_number:"",dhsud_registration_number:"",validation_date:""}),N=t=>{const{name:i,value:j}=t.target;x({...s,[i]:j}),u({...l,[i]:""})},g=()=>{const t={prc_liscence_number:s.prc_liscence_number?"":"PRC License Number is required.",dhsud_registration_number:s.dhsud_registration_number?"":"DHSUD Registration Number is required.",validation_date:s.validation_date?"":"Validity Date is required."};return u(t),Object.values(t).every(i=>i==="")},y=async()=>{if(g()&&!o){d(!0);try{const t=await E.put(`editLicense/${r.id}`,s,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`}});n(),F.fire({icon:"success",title:"Success",text:t.data.message,showConfirmButton:!1,timer:2e3,timerProgressBar:!0})}catch(t){console.error("Error updating license:",t),F.fire({icon:"error",title:"Error",text:"Failed to update license. Please try again.",showConfirmButton:!0})}finally{d(!1)}}};return e.jsxs(R,{children:[e.jsx($,{children:e.jsx(D,{className:"w-8 h-8 rounded-md bg-green-500 hover:bg-green-400",children:e.jsx(C,{icon:M})})}),e.jsxs(k,{className:"md:w-[90%]",children:[e.jsxs(P,{children:[e.jsx(I,{className:"text-start",children:"Update License"}),e.jsx(V,{children:e.jsxs("div",{className:"text-start mt-5 grid gap-4 py-4",children:[e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"fullname",children:"Fullname"}),e.jsx(w,{className:"cursor-not-allowed",value:`${(p=r==null?void 0:r.personal_info)==null?void 0:p.first_name} ${r.personal_info.middle_name} ${(m=r==null?void 0:r.personal_info)==null?void 0:m.last_name}`,readOnly:!0})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"prc_liscence_number",children:"PRC License Number"}),e.jsx(w,{name:"prc_liscence_number",placeholder:"Enter PRC License No:",value:s.prc_liscence_number,onChange:N}),l.prc_liscence_number&&e.jsx("span",{className:"text-red-500 text-sm",children:l.prc_liscence_number})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"dhsud_registration_number",children:"DHSUD Registration Number"}),e.jsx(w,{name:"dhsud_registration_number",placeholder:"Enter DHSUD Registration No:",value:s.dhsud_registration_number,onChange:N}),l.dhsud_registration_number&&e.jsx("span",{className:"text-red-500 text-sm",children:l.dhsud_registration_number})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"validation_date",children:"Validity Date"}),e.jsx(w,{type:"date",name:"validation_date",value:s.validation_date,onChange:N}),l.validation_date&&e.jsx("span",{className:"text-red-500 text-sm",children:l.validation_date})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"type",children:"Type"}),e.jsxs(L,{name:"role",defaultValue:s.role,onValueChange:t=>x({...s,role:t}),children:[e.jsx(B,{className:"h-9 bg-white",children:e.jsx(U,{placeholder:"Select Agent or Broker"})}),e.jsxs(Y,{children:[e.jsx(h,{value:"1",children:"Agent"}),e.jsx(h,{value:"2",children:"Broker"})]})]})]})]})})]}),e.jsx(W,{children:e.jsx(D,{className:"bg-green-500 hover:bg-green-400",type:"button",onClick:y,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Saving..."}),e.jsx("span",{className:"animate-spin border-2 cursor-not-allowed border-white border-t-transparent rounded-full w-4 h-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{icon:O}),e.jsx("span",{children:"Save changes"})]})})})]})]})}function de(){const[r,n]=b.useState([]),[o,d]=b.useState("all"),[s,x]=b.useState(""),l=async()=>{try{const a=await E.get("agent-broker",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`}});n(a.data.unlicensed)}catch(a){console.error("Error fetching members:",a)}};b.useEffect(()=>{l()},[]);const u=a=>{d(a==="all"?"all":parseInt(a))},N=a=>{x(a.target.value)},g=r.filter(a=>{var m,t,i,j;const _=`${(m=a==null?void 0:a.personal_info)==null?void 0:m.first_name} ${(t=a==null?void 0:a.personal_info)==null?void 0:t.last_name}`.toLowerCase(),p=((i=a==null?void 0:a.user)==null?void 0:i.role)===1?"agent":((j=a==null?void 0:a.user)==null?void 0:j.role)===2?"broker":"";return _.includes(s.toLowerCase())||p.includes(s.toLowerCase())}),y=o==="all"?g:g.slice(0,o);return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"py-2 flex flex-row justify-between gap-4",children:[e.jsxs(L,{onValueChange:u,children:[e.jsxs(B,{className:"w-[120px] border border-primary md:w-28",children:[e.jsx("span",{className:"text-[#172554]",children:"Show"}),e.jsx(U,{placeholder:"All"})," "]}),e.jsxs(Y,{children:[e.jsx(h,{value:"all",children:"All"}),e.jsx(h,{value:"10",children:"10"}),e.jsx(h,{value:"20",children:"20"}),e.jsx(h,{value:"30",children:"30"}),e.jsx(h,{value:"40",children:"40"}),e.jsx(h,{value:"50",children:"50"})]})]}),e.jsx(w,{type:"text",placeholder:"Search",className:"w-52 md:w-full",value:s,onChange:N})]}),e.jsx("div",{className:"fade-in-left",children:e.jsxs(q,{children:[e.jsx(z,{className:"bg-primary",children:e.jsxs(S,{children:[e.jsx(f,{children:"#"}),e.jsx(f,{children:"Fullname"}),e.jsx(f,{children:"Type"}),e.jsx(f,{children:"Email address"}),e.jsx(f,{children:"Contact number"}),e.jsx(f,{children:"Date Approved"}),e.jsx(f,{className:"text-right",children:"Action"})]})}),e.jsx(Q,{children:y.length>0?y.map((a,_)=>{var p,m,t,i,j,A,T;return e.jsxs(S,{children:[e.jsx(c,{className:"font-medium border border-[#bfdbfe]",children:_+1}),e.jsxs(c,{className:"font-medium border border-[#bfdbfe] uppercase",children:[(p=a==null?void 0:a.personal_info)==null?void 0:p.first_name," ",a.personal_info.middle_name," ",(m=a==null?void 0:a.personal_info)==null?void 0:m.last_name]}),e.jsx(c,{className:"border border-[#bfdbfe]",children:((t=a==null?void 0:a.user)==null?void 0:t.role)===1?e.jsx("span",{className:"inline-flex unlicenseds-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-blue-700/10 ring-inset",children:"Agent"}):((i=a==null?void 0:a.user)==null?void 0:i.role)===2?e.jsx("span",{className:"inline-flex unlicenseds-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-green-600/20 ring-inset",children:"Broker"}):(j=a==null?void 0:a.user)==null?void 0:j.role}),e.jsx(c,{className:"border border-[#bfdbfe]",children:(A=a==null?void 0:a.user)==null?void 0:A.email}),e.jsx(c,{className:"border border-[#bfdbfe]",children:(T=a==null?void 0:a.personal_info)==null?void 0:T.phone}),e.jsx(c,{className:"border border-[#bfdbfe]",children:J(a==null?void 0:a.user.updated_at)}),e.jsx(c,{className:"text-right border border-[#bfdbfe]",children:e.jsxs("div",{className:"flex flex-row gap-1 justify-end",children:[e.jsx(X,{unlicensed:a}),e.jsx(ee,{unlicensed:a,agentUnliscenced:l})]})})]},a.id)}):e.jsx(S,{children:e.jsx(c,{colSpan:7,className:"text-center border border-[#bfdbfe]",children:"No data available"})})})]})}),e.jsx("div",{className:"flex flex-row justify-end mt-3",children:e.jsx("div",{children:e.jsxs("p",{className:"text-[#172554] text-sm w-full",children:["Showing 1 to ",o==="all"?g.length:o," of ",g.length," entries"]})})})]})}export{de as default};
