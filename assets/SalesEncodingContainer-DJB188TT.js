import{j as e,L as Ne,r as n,R as ve,B as q,F as m,$ as Se,ae as te,ac as le,aa as re,af as ne,ad as oe,a4 as ie,ag as we,g as ce,d as Q,S as E,ah as ye,ai as _e,aj as Ce,a1 as ke,u as Ae,a3 as Be,a2 as Fe}from"./index-xsBp2E4G.js";import{B as Pe,a as De,b as Le,c as Ee}from"./breadcrumb-BKB60q9Q.js";import{c as Te,C as Ie,b as Re}from"./card-DKVU-Ubm.js";import{I as v}from"./input-D9YYjcoe.js";import{S as T,a as I,b as R,c as O,d as r}from"./select-DqFgiDyJ.js";import{D as de,a as Oe,b as me,c as ue,d as xe,g as ge,e as fe,T as $e,h as ze,i as Z,j as B,k as qe,l as y}from"./dialog-bQiqH9hB.js";import{L as x}from"./label-4mP_r72_.js";import{N as he}from"./react-number-format.es-31eZzDDa.js";import{V as Ge}from"./ViewReceipt-By02G0oE.js";function Me(){return e.jsx("div",{className:"bg-gradient-to-r from-blue-900 via-blue-800 to-blue-700 shadow-lg flex flex-row items-center gap-4 p-4 rounded-xl mb-8 border border-blue-800/40",children:e.jsx("div",{className:"flex flex-col items-start md:items-center md:justify-center md:ml-10 text-accent fade-in-right w-full",children:e.jsx(Pe,{children:e.jsxs(De,{children:[e.jsx(Le,{className:"text-accent",children:e.jsx(Ne,{to:"/admin/sales-encoding",children:"List of Sales Encoding"})}),e.jsx(Ee,{})]})})})})}function Ve({fetchAgent:i}){const[l,f]=n.useState({agent_id:"",category:"",date_on_sale:new Date().toISOString().split("T")[0],amount:"",location:"",remarks:"",image:null,client_name:"",block_and_lot:null}),[F,b]=n.useState(""),[_,C]=n.useState("Choose agent or broker"),[c,p]=n.useState({}),[P,D]=n.useState(!1),[j,N]=n.useState(!1),[w,L]=n.useState([]),[k,S]=n.useState(null),[s,h]=ve.useState(""),[A,G]=n.useState(null),M=w.filter(a=>`${a.personal_info.first_name} ${a.personal_info.middle_name} ${a.personal_info.last_name} ${a.personal_info.extension_name||""}`.toLowerCase().includes(F.toLowerCase()));n.useEffect(()=>{(async()=>{try{const t=await Q.get("sales-encoding",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});L(t.data.agents)}catch(t){console.error("Error fetching agents:",t)}})()},[]);const V=a=>{const{value:t}=a;h(t),f({...l,amount:t}),p(t===""?{amount:"Amount is required"}:{})},$=(a,t)=>{if(f(a==="category"?{...l,category:t,block_and_lot:t==="Block and lot"?"":null}:{...l,[a]:t}),a==="agent_id"){const u=w.find(g=>g.id===t);if(u){const g=`${u.personal_info.first_name} ${u.personal_info.middle_name} ${u.personal_info.last_name}`;C(g)}}},H=a=>{const t=a.target.value;f({...l,date_on_sale:t})},J=a=>{const{name:t,value:u}=a.target;f({...l,[t]:u})},W=a=>{f({...l,block_and_lot:a.target.value})},z=a=>{var u;const t=((u=a.target.files)==null?void 0:u[0])||null;if(t&&(["image/jpeg","image/png","image/jpg"].includes(t.type)?t.size>5242880?(S("File size exceeds the maximum limit of 5MB."),f({...l,image:null})):(S(null),f({...l,image:t})):(S("Invalid file type. Only JPEG, PNG, and JPG are allowed."),f({...l,image:null}))),t){const g=new FileReader;g.onloadend=()=>{G(g.result)},g.onerror=()=>{S("Failed to read file")},g.readAsDataURL(t)}},Y=()=>{const a={};return l.agent_id||(a.agent_id="Agent/Broker is required."),l.category||(a.category="Category is required."),l.date_on_sale||(a.date_on_sale="Date of Sale is required."),l.amount||(a.amount="Amount of Sale is required."),l.location||(a.location="Location of Property is required."),l.remarks||(a.remarks="Remarks are required."),l.image||(a.image="Proof of Transaction is required."),l.client_name||(a.client_name="Client name is required."),l.category==="Block and lot"&&!l.block_and_lot&&(a.block_and_lot="Block & Lot is required."),p(a),Object.keys(a).length===0},U=async a=>{if(a.preventDefault(),!Y()||j)return;N(!0);const t=new FormData;Object.entries(l).forEach(([u,g])=>{u==="block_and_lot"?l.category==="Block and lot"&&g?t.append(u,g):t.append(u,""):u==="image"?g&&t.append(u,g):t.append(u,g)});try{await Q.post("sales-encoding",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("access_token")}`}}),i(),f({agent_id:"",category:"",date_on_sale:new Date().toISOString().split("T")[0],amount:"",location:"",remarks:"",image:null,client_name:"",block_and_lot:null}),h(""),C("Choose agent or broker"),D(!1),G(null),b(""),E.fire({icon:"success",title:"Success",text:"Sales created successfully.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch{E.fire({icon:"error",title:"Failed to create sales encoding",text:"There was an error while saving your sales encoding. Please try again.",confirmButtonText:"Retry"})}finally{N(!1)}};return e.jsx("div",{children:e.jsxs(de,{open:P,onOpenChange:D,children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(q,{className:"h-10 bg-gradient-to-r from-blue-500 to-blue-700 text-white shadow-md hover:from-blue-600 hover:to-blue-800 transition-all duration-200 rounded-lg",children:[e.jsx(m,{icon:Se,className:"mr-2"}),"Add Sales"]})}),e.jsx(me,{className:"md:w-[90%] max-w-xl h-full md:h-[85%] overflow-auto bg-gradient-to-br from-blue-50 to-blue-100 shadow-2xl border border-blue-200",children:e.jsxs(ue,{children:[e.jsxs(xe,{className:"text-start text-2xl font-bold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:te,className:"text-blue-500"}),"Add Sales Encoding"]}),e.jsx(ge,{children:e.jsx("form",{onSubmit:U,children:e.jsxs("div",{className:"text-start flex flex-col gap-6 mt-4",children:[e.jsxs("div",{className:"grid w-full items-start gap-2",children:[e.jsxs(x,{className:"font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:le,className:"text-blue-400"}),"Agent/Broker"]}),e.jsxs(T,{onValueChange:a=>$("agent_id",a),children:[e.jsx(I,{className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:e.jsx(R,{placeholder:"Choose agent or broker",children:_})}),e.jsxs(O,{children:[e.jsxs("div",{className:"px-2 py-2 sticky top-0 bg-white z-10",children:[e.jsx("input",{type:"text",placeholder:"Search agent...",value:F,onChange:a=>b(a.target.value),onMouseDown:a=>a.stopPropagation(),onClick:a=>a.stopPropagation(),onKeyDown:a=>a.stopPropagation(),className:"w-full px-2 py-1 rounded border border-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-200 text-sm pr-8"}),F&&e.jsx("button",{type:"button",onClick:()=>b(""),className:"absolute right-4 top-1/2 -translate-y-1/2 text-red-400 hover:text-red-600",tabIndex:-1,onMouseDown:a=>a.stopPropagation(),children:"Ã—"})]}),M.length===0?e.jsx("div",{className:"px-2 py-2 text-gray-500 text-sm",children:"No agents found."}):M.map(a=>e.jsxs(r,{value:a.id,children:[a.personal_info.first_name," ",a.personal_info.middle_name," ",a.personal_info.last_name]},a.id))]})]}),c.agent_id&&e.jsx("p",{className:"text-red-500 text-xs",children:c.agent_id})]}),e.jsxs("div",{className:"grid w-full items-start gap-2",children:[e.jsx(x,{className:"font-semibold text-blue-900",children:"Category"}),e.jsxs(T,{onValueChange:a=>$("category",a),children:[e.jsx(I,{className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:e.jsx(R,{placeholder:"Select category"})}),e.jsxs(O,{children:[e.jsx(r,{value:"Lot only",children:"Lot only"}),e.jsx(r,{value:"House and lot",children:"House and lot"}),e.jsx(r,{value:"Condominium/Apartment",children:"Condominium/Apartment"}),e.jsx(r,{value:"Commercial Properties",children:"Commercial Properties"}),e.jsx(r,{value:"Rental Properties",children:"Rental Properties"}),e.jsx(r,{value:"Farm Lot",children:"Farm Lot"}),e.jsx(r,{value:"For Assumption",children:"For Assumption"}),e.jsx(r,{value:"Block and lot",children:"Block and lot"})]})]}),c.category&&e.jsx("p",{className:"text-red-500 text-xs",children:c.category})]}),e.jsxs("div",{className:"grid w-full items-center gap-2",children:[e.jsxs(x,{className:"font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:re,className:"text-blue-400"}),"Client Name"]}),e.jsx(v,{type:"text",name:"client_name",placeholder:"Enter client name",value:l.client_name,onChange:J,className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),c.client_name&&e.jsx("p",{className:"text-red-500 text-xs",children:c.client_name})]}),l.category==="Block and lot"&&e.jsxs("div",{className:"grid w-full items-center gap-2",children:[e.jsxs(x,{className:"font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:ne,className:"text-blue-400"}),"Block & Lot ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(v,{type:"text",name:"block_and_lot",placeholder:"e.g. Block 01, Lot 10",value:l.block_and_lot||"",onChange:W,className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:l.category==="Block and lot"}),c.block_and_lot&&e.jsx("p",{className:"text-red-500 text-xs",children:c.block_and_lot})]}),e.jsxs("div",{className:"grid w-full items-center gap-2",children:[e.jsxs(x,{className:"font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:oe,className:"text-blue-400"}),"Reservation Date"]}),e.jsx(v,{type:"date",name:"date_on_sale",value:l.date_on_sale,onChange:H,className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),c.date_on_sale&&e.jsx("p",{className:"text-red-500 text-xs",children:c.date_on_sale})]}),e.jsxs("div",{className:"grid w-full items-center gap-2",children:[e.jsx(x,{className:"font-semibold text-blue-900",children:"Amount of Sale"}),e.jsx(he,{value:s,thousandSeparator:!0,decimalScale:2,fixedDecimalScale:!0,allowNegative:!1,placeholder:"0.00",onValueChange:V,className:"flex h-9 w-full rounded-lg border border-blue-300 bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-200 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"}),c.amount&&e.jsx("p",{className:"text-red-500 text-xs",children:c.amount})]}),e.jsxs("div",{className:"grid w-full items-center gap-2",children:[e.jsxs(x,{className:"font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:ie,className:"text-blue-400"}),"Location of Property"]}),e.jsx(v,{type:"text",name:"location",placeholder:"Enter location of property",value:l.location,onChange:J,className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),c.location&&e.jsx("p",{className:"text-red-500 text-xs",children:c.location})]}),e.jsxs("div",{className:"grid w-full items-center gap-2",children:[e.jsx(x,{className:"font-semibold text-blue-900",children:"Remarks"}),e.jsxs(T,{onValueChange:a=>$("remarks",a),children:[e.jsx(I,{className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:e.jsx(R,{placeholder:"Select remarks"})}),e.jsxs(O,{children:[e.jsx(r,{value:"Sold",children:"Sold"}),e.jsx(r,{value:"Not Sold",children:"Not Sold"}),e.jsx(r,{value:"Pre-Selling",children:"Pre-Selling"}),e.jsx(r,{value:"RFO",children:"Ready for Occupancy - (RFO)"})]})]}),c.remarks&&e.jsx("p",{className:"text-red-500 text-xs",children:c.remarks})]}),e.jsxs("div",{className:"grid w-full gap-2",children:[e.jsxs(x,{className:"font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:we,className:"text-blue-400"}),"Upload Proof of Transaction",e.jsx("span",{className:"text-xs text-red-500 ml-2",children:"(JPEG, PNG, JPG only, max 5MB)"})]}),e.jsx(v,{type:"file",name:"image",accept:".jpg,.jpeg,.png,image/jpeg,image/png",onChange:z,className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),k&&e.jsx("p",{className:"text-red-500 text-xs",children:k}),c.image&&e.jsx("p",{className:"text-red-500 text-xs",children:c.image}),A&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:A,alt:"Preview",className:"max-w-xs rounded-lg border border-blue-200 shadow"})})]}),e.jsx(fe,{className:"mt-4",children:e.jsx(q,{type:"submit",disabled:j,className:"w-full bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-lg shadow hover:from-blue-700 hover:to-blue-900 flex items-center justify-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Submitting..."}),e.jsx("span",{className:"animate-spin border-2 border-white border-t-transparent rounded-full w-4 h-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:ce}),e.jsx("span",{children:"Submit"})]})})})]})})})]})})]})})}const He=({sales:i,open:l,onOpenChange:f,getAgentBroker:F,fetchAgent:b})=>{var ae,se;const _=`https://athomes.site/${i.image}`,[C,c]=n.useState((ae=i.agent)!=null&&ae.id?String(i.agent.id):""),[p,P]=n.useState(i.category||""),[D,j]=n.useState(((se=i.date_on_sale)==null?void 0:se.split("T")[0])||""),[N,w]=n.useState(i.amount.toString()||""),[L,k]=n.useState(i.location||""),[S,s]=n.useState(_),[h,A]=n.useState(i.remarks||""),[G,M]=n.useState(i.client_name||""),[V,$]=n.useState(i.block_and_lot||""),[H,J]=n.useState(!1),[W,z]=n.useState(null),[Y,U]=n.useState(null),[a,t]=n.useState(null),u=n.useRef(null),g=d=>{var K;const o=(K=d.target.files)==null?void 0:K[0];if(o){const je=["image/jpeg","image/png","image/jpg"];if(!o.type.startsWith("image/")||!je.includes(o.type)){t("Please select a valid image file (JPEG, PNG, or JPG).");return}if(o.size>5242880){t("The selected file exceeds the maximum size of 5MB.");return}t(null);const X=new FileReader;X.onloadend=()=>{typeof X.result=="string"&&(s(X.result),U(o))},X.readAsDataURL(o)}else t("Please select a valid image file.")},ee=()=>{s(_),u.current&&(u.current.value=""),U(null)};n.useEffect(()=>{var d,o;l&&(c((d=i.agent)!=null&&d.id?String(i.agent.id):""),P(i.category||""),j(((o=i.date_on_sale)==null?void 0:o.split("T")[0])||""),w(i.amount.toString()||""),k(i.location||""),A(i.remarks||""),M(i.client_name||""),$(i.block_and_lot||""),s(_),z(null),U(null))},[l,i]);const be=async d=>{if(d.preventDefault(),!H){J(!0),z(null);try{const o=new FormData;o.append("agent_id",C),o.append("category",p),o.append("date_on_sale",D),o.append("amount",N),o.append("location",L),o.append("remarks",h),o.append("client_name",G),p==="Block and lot"&&V&&o.append("block_and_lot",V),Y&&o.append("image",Y),(await Q.post(`updateSalesEncoding/${i.id}`,o,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"multipart/form-data"}})).status===200&&(f(!1),w(""),b(),E.fire({icon:"success",title:"Success",text:"Sales encoding updated successfully!",timer:2e3,timerProgressBar:!0,showConfirmButton:!1}))}catch(o){if(o.response&&o.response.data&&o.response.data.errors){const K=Object.values(o.response.data.errors).flat().join(", ");z(K)}else z("An error occurred while updating.")}finally{J(!1)}}},pe=d=>{const{value:o}=d;w(o)};return e.jsx(de,{open:l,onOpenChange:f,children:e.jsxs(me,{className:"md:w-[90%] max-w-xl h-full overflow-auto bg-gradient-to-br from-blue-50 to-blue-100 shadow-2xl border border-blue-200",children:[e.jsxs(ue,{className:"text-start",children:[e.jsxs(xe,{className:"text-2xl font-bold text-blue-900 flex items-center gap-2",children:[e.jsx(m,{icon:te,className:"text-blue-500"}),"Edit Sales Encoding"]}),e.jsx(ge,{children:e.jsx("span",{className:"text-blue-800 md:text-sm mt-1",children:"Make changes to your sales here. Click save when you're done."})})]}),e.jsxs("form",{onSubmit:be,children:[e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"agent",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:le,className:"text-blue-400"}),"Agent/Broker"]}),e.jsxs(T,{value:C,onValueChange:c,children:[e.jsx(I,{className:"col-span-3 uppercase rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:e.jsx(R,{placeholder:"Choose agent or broker"})}),e.jsx(O,{children:F.map(d=>e.jsxs(r,{className:"uppercase",value:String(d.id),children:[d.personal_info.first_name," ",d.personal_info.middle_name," ",d.personal_info.last_name," ",d.personal_info.extension_name]},d.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"category",className:"text-blue-900 font-semibold",children:"Category"}),e.jsxs(T,{value:p,onValueChange:P,children:[e.jsx(I,{className:"col-span-3 rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:e.jsx(R,{placeholder:"Select category"})}),e.jsxs(O,{children:[e.jsx(r,{value:"Lot only",children:"Lot only"}),e.jsx(r,{value:"House and lot",children:"House and lot"}),e.jsx(r,{value:"Condominium/Apartment",children:"Condominium/Apartment"}),e.jsx(r,{value:"Commercial Properties",children:"Commercial Properties"}),e.jsx(r,{value:"Rental Properties",children:"Rental Properties"}),e.jsx(r,{value:"Farm Lot",children:"Farm Lot"}),e.jsx(r,{value:"Block and lot",children:"Block and lot"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"client_name",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:re,className:"text-blue-400"}),"Client Name"]}),e.jsx(v,{value:G,onChange:d=>M(d.target.value),className:"col-span-3 rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"})]}),p==="Block and lot"&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"block_and_lot",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:ne,className:"text-blue-400"}),"Block & Lot"]}),e.jsx(v,{value:V,onChange:d=>$(d.target.value),placeholder:"e.g. Block 01, Lot 10",className:"col-span-3 rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:p==="Block and lot"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"date_on_sale",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:oe,className:"text-blue-400"}),"Date"]}),e.jsx(v,{type:"date",value:D,onChange:d=>j(d.target.value),className:"col-span-3 rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"amount",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:ye,className:"text-green-500"}),"Amount"]}),e.jsx(he,{value:N,thousandSeparator:!0,decimalScale:2,fixedDecimalScale:!0,allowNegative:!1,placeholder:"0.00",onValueChange:pe,className:"flex h-9 col-span-3 w-full rounded-lg border border-blue-300 bg-transparent px-3 py-1 text-base shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-200 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"location",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:ie,className:"text-red-400"}),"Location"]}),e.jsx(v,{value:L,onChange:d=>k(d.target.value),className:"col-span-3 rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"remarks",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:_e,className:"text-indigo-400"}),"Remarks"]}),e.jsxs(T,{value:h,onValueChange:A,children:[e.jsx(I,{className:"col-span-3 rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",children:e.jsx(R,{placeholder:"Select remarks"})}),e.jsxs(O,{children:[e.jsx(r,{value:"Sold",children:"Sold"}),e.jsx(r,{value:"Not Sold",children:"Not Sold"}),e.jsx(r,{value:"Pre-Selling",children:"Pre-Selling"}),e.jsx(r,{value:"RFO",children:"Ready for Occupancy - (RFO)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(x,{htmlFor:"Image",className:"text-blue-900 font-semibold flex items-center gap-2",children:[e.jsx(m,{icon:Ce,className:"text-pink-400"}),"Proof of Transaction"]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("span",{className:"text-xs text-red-500 ml-2",children:"(JPEG, PNG, JPG only, max 5MB)"}),e.jsx(v,{type:"file",accept:".jpg,.jpeg,.png,image/jpeg,image/png",onChange:g,ref:u,className:"rounded-lg border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),a&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a})]})]}),S&&e.jsxs("div",{className:"relative mt-4 flex justify-center",children:[e.jsx("img",{src:S,alt:"Selected Preview",className:"max-h-48 object-cover rounded-lg border border-blue-200 shadow"}),S!==_&&e.jsx(q,{type:"button",onClick:ee,className:"absolute top-2 right-2 h-8 w-8 bg-red-500 hover:bg-red-400 rounded-full p-1 shadow-md",children:e.jsx(m,{icon:ke,className:"text-white"})})]})]}),W&&e.jsx("div",{className:"text-red-500 text-center",children:W}),e.jsx(fe,{children:e.jsx(q,{type:"submit",disabled:H,className:"w-full bg-gradient-to-r from-green-500 to-green-700 hover:from-green-600 hover:to-green-800 text-white rounded-lg shadow flex items-center justify-center gap-2",children:H?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Saving..."}),e.jsx("span",{className:"animate-spin border-2 border-white border-t-transparent rounded-full w-4 h-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{icon:ce}),e.jsx("span",{children:"Save changes"})]})})})]})]})})};function sa(){const[i,l]=n.useState([]),[f,F]=n.useState([]),[b,_]=n.useState(""),[C,c]=n.useState(10),[p,P]=n.useState(null),D=Ae();n.useEffect(()=>{j()},[]);const j=async()=>{try{const s=await Q.get("sales-encoding",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`}});l(s.data.salesEncodingAdmin.map(h=>({...h,amount:typeof h.amount=="number"?h.amount:parseFloat(h.amount)}))),F(s.data.agents),c(s.data.salesEncodingAdmin.length),l(s.data.salesEncodingAdmin)}catch{E.fire({icon:"error",title:"Error",text:"Failed to fetching data. Please login again.",confirmButtonText:"OK"}),localStorage.clear(),console.clear(),D("/")}},N=i.filter(s=>s.category.toLowerCase().includes(b.toLowerCase())||new Date(s.date_on_sale).toLocaleDateString().toLowerCase().includes(b.toLowerCase())||s.amount.toString().toLowerCase().includes(b.toLowerCase())||s.location.toLowerCase().includes(b.toLowerCase())||s.remarks.toLowerCase().includes(b.toLowerCase())||s.client_name.toLowerCase().includes(b.toLowerCase())),w=N.slice(0,C),L=new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}),k=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"2-digit"}),S=async s=>{if((await E.fire({title:"Are you sure?",text:"Sale cant be revert â€” feel free to make a new one.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await Q.delete(`sales-encoding/${s}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`}}),E.fire({icon:"success",title:"Deleted!",text:"Sales encoding has been deleted.",timer:1500,showConfirmButton:!1}),j()}catch{E.fire({icon:"error",title:"Error!",text:"Failed to delete sales encoding."})}};return e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"ml-72 md:ml-0  gap-2 items-start justify-center mr-5 md:px-2 ",children:[e.jsx(Me,{}),e.jsxs(Te,{className:"bg-[#eef2ff] border-b-4 border-primary fade-in-left md:w-[380px]",children:[e.jsx(Ie,{children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4 justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start bg-gradient-to-r from-blue-100 to-blue-200 px-4 py-2 rounded-lg shadow-sm",children:[e.jsx("span",{className:"text-xs text-blue-700 font-semibold",children:"Total Sales Encodings"}),e.jsx("span",{className:"text-2xl font-bold text-blue-900",children:N.length})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(Ve,{fetchAgent:j})})]})}),e.jsxs(Re,{children:[e.jsxs("div",{className:"py-2 flex flex-row justify-between gap-4",children:[e.jsxs(T,{onValueChange:s=>c(s==="all"?N.length:parseInt(s,10)),children:[e.jsxs(I,{className:"w-[120px] border border-primary",children:[e.jsx("span",{className:"text-[#172554]",children:"Show"}),e.jsx(R,{placeholder:"All"})]}),e.jsxs(O,{children:[e.jsx(r,{value:"all",children:"All"}),e.jsx(r,{value:"5",children:"5"}),e.jsx(r,{value:"10",children:"10"}),e.jsx(r,{value:"20",children:"20"}),e.jsx(r,{value:"30",children:"30"}),e.jsx(r,{value:"40",children:"40"}),e.jsx(r,{value:"50",children:"50"})]})]}),e.jsx(v,{type:"text",placeholder:"Search",className:"w-52 md:w-full",value:b,onChange:s=>_(s.target.value)})]}),e.jsx("div",{className:"fade-in-left ",children:e.jsxs($e,{className:"w-full",children:[e.jsx(ze,{className:"bg-primary text-base",children:e.jsxs(Z,{children:[e.jsx(B,{children:"#"}),e.jsx(B,{children:"Client name"}),e.jsx(B,{children:"Category"}),e.jsx(B,{children:"Reservation Date"}),e.jsx(B,{children:"Amount"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Remarks"}),e.jsx(B,{className:"text-right",children:"Action"})]})}),e.jsxs(qe,{children:[w.length===0&&e.jsx(Z,{children:e.jsx(y,{colSpan:8,className:"text-center text-sm font-medium text-gray-500",children:"No record found."})}),w.map((s,h)=>e.jsxs(Z,{children:[e.jsx(y,{className:"font-medium border border-[#bfdbfe]",children:h+1}),e.jsx(y,{className:"border border-[#bfdbfe]",children:s.client_name}),e.jsx(y,{className:"font-medium border border-[#bfdbfe]",children:s.category}),e.jsx(y,{className:"border border-[#bfdbfe]",children:k.format(new Date(s.date_on_sale))}),e.jsx(y,{className:"border border-[#bfdbfe]",children:e.jsx("span",{children:L.format(s.amount)})}),e.jsx(y,{className:"border border-[#bfdbfe]",children:s.location}),e.jsx(y,{className:"border border-[#bfdbfe]",children:s.remarks}),e.jsx(y,{className:"text-right border border-[#bfdbfe]",children:e.jsxs("div",{className:"flex flex-row gap-1 justify-end",children:[e.jsx(Ge,{sales:s,dateFormatter:k,currencyFormatter:L}),e.jsx(q,{className:"h-8 w-8 font-medium bg-green-500 hover:bg-green-400 text-sm rounded-md",onClick:()=>P(s.id),children:e.jsx(m,{icon:Be})}),e.jsx(He,{sales:s,open:p===s.id,onOpenChange:A=>P(A?s.id:null),getAgentBroker:f,fetchAgent:j}),e.jsx(q,{className:"h-8 w-8 font-medium bg-red-500 hover:bg-red-400 text-sm rounded-md",onClick:()=>S(s.id),children:e.jsx(m,{icon:Fe})})]})})]},s.id))]})]})}),e.jsx("div",{className:"flex flex-row justify-end mt-3",children:e.jsx("div",{children:e.jsxs("p",{className:"text-[#172554] text-sm w-full",children:["Showing 1 to ",Math.min(C,N.length)," of ",N.length," entries"]})})})]})]})]})})}export{sa as default};
