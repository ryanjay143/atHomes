import{j as e,N as K,a3 as W,r as t,B,F as y,_ as q,e as J,c as O,S as $,u as Z,X as g,W as ee,a as se}from"./index-xgvVzwjv.js";import{S as P,a as Y,b as V,c as R,d as c}from"./select-BQxZfWY8.js";import{I as w}from"./input-D7RsSNb2.js";import{D as H,a as M,b as z,c as Q,d as X,g as G,T as re,h as le,i as E,j as a,k as oe,l as o,f as ie}from"./dialog-CIVa7nUW.js";import{f as ae,a as ce}from"./dateUtils-D6w6W0GJ.js";import{L as v}from"./label-DZZIm28E.js";const de=W("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function I({className:r,variant:m,...l}){return e.jsx("div",{className:K(de({variant:m}),r),...l})}function ne({agent:r,agentList:m}){var D,d;const[l,C]=t.useState(!1),[x,S]=t.useState(!1),[h,A]=t.useState({role:((d=(D=r.user)==null?void 0:D.role)==null?void 0:d.toString())||"1"}),k=async()=>{if(!l){C(!0);try{const i=await O.put(`editType/${r.user.id}`,{role:h.role},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`}});m(),S(!1),$.fire({icon:"success",title:"Success",text:i.data.message,showConfirmButton:!1,timer:2e3,timerProgressBar:!0})}catch(i){console.error("Error updating role:",i),$.fire({icon:"error",title:"Oops",text:"Failed to update role. Please try again."})}finally{C(!1)}}};return e.jsxs(H,{open:x,onOpenChange:S,children:[(r==null?void 0:r.prc_liscence_number)!==""&&e.jsx(M,{children:e.jsx(B,{className:`w-8 h-8 rounded-md ${(r==null?void 0:r.prc_liscence_number)===""?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-500 hover:bg-green-400"}`,disabled:(r==null?void 0:r.prc_liscence_number)==="",children:e.jsx(y,{icon:q,className:"text-[#eff6ff]"})})}),e.jsx(z,{className:"md:max-w-[425px]",children:e.jsxs(Q,{children:[e.jsx(X,{className:"text-start",children:"Edit Type"}),e.jsx(G,{children:e.jsxs("div",{className:"text-start flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"accnt",children:"Account number"}),e.jsx(w,{type:"text",value:r.user.acct_number,readOnly:!0,className:"cursor-not-allowed"})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"name",children:"Fullname"}),e.jsx(w,{type:"text",value:`${r.personal_info.first_name} ${r.personal_info.middle_name} ${r.personal_info.last_name} ${r.personal_info.extension_name}`,readOnly:!0,className:"cursor-not-allowed"})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"email",children:"Email address"}),e.jsx(w,{type:"email",value:r.user.email,readOnly:!0,className:"cursor-not-allowed"})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"phone",children:"Contact number"}),e.jsx(w,{type:"text",value:r==null?void 0:r.personal_info.phone,readOnly:!0,className:"cursor-not-allowed"})]}),e.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[e.jsx(v,{htmlFor:"type",children:"Type"}),e.jsxs(P,{name:"role",defaultValue:h.role,onValueChange:i=>A({...h,role:i}),children:[e.jsx(Y,{className:"h-9 bg-white",children:e.jsx(V,{placeholder:"Select Agent or Broker"})}),e.jsxs(R,{children:[e.jsx(c,{value:"1",children:"Agent"}),e.jsx(c,{value:"2",children:"Broker"})]})]})]}),e.jsx("div",{className:"flex justify-end w-full gap-2",children:e.jsx(B,{className:"w-full bg-green-500 hover:bg-green-400",onClick:k,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Updating..."}),e.jsx("span",{className:"animate-spin border-2 cursor-not-allowed border-white border-t-transparent rounded-full w-4 h-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{icon:J}),e.jsx("span",{className:"text-[#eff6ff]",children:"Update"})]})})})]})})]})})]})}function je(){const[r,m]=t.useState([]),[l,C]=t.useState(""),[x,S]=t.useState("all"),h=Z(),A=async()=>{try{const s=await O.get("agent-broker",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`}});m(s.data.agentList)}catch(s){console.error("Error fetching agent and broker:",s),$.fire({icon:"error",title:"Error",text:"Failed to fetching agent and broker. Please login again.",confirmButtonText:"OK"}),localStorage.clear(),console.clear(),h("/")}};t.useEffect(()=>{A()},[]);const k=s=>{C(s.target.value)},D=s=>{S(s==="all"?"all":parseInt(s))},d=r.filter(s=>{var u,p,f,j,b,N,_;const F=`${(u=s==null?void 0:s.user)==null?void 0:u.acct_number}`.toLowerCase(),T=`${(p=s==null?void 0:s.personal_info)==null?void 0:p.first_name} ${(f=s==null?void 0:s.personal_info)==null?void 0:f.middle_name} ${(j=s==null?void 0:s.personal_info)==null?void 0:j.last_name} ${(b=s==null?void 0:s.personal_info)==null?void 0:b.extension_name}`.toLowerCase(),L=((N=s==null?void 0:s.user)==null?void 0:N.role)===1?"agent":((_=s==null?void 0:s.user)==null?void 0:_.role)===2?"broker":"";return T.includes(l.toLowerCase())||L.includes(l.toLowerCase())||F.includes(l.toLowerCase())}),i=x==="all"?d:d.slice(0,x);return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"py-2 flex flex-row justify-between gap-4",children:[e.jsxs(P,{onValueChange:D,children:[e.jsxs(Y,{className:"w-[120px] border border-primary md:w-28",children:[e.jsx("span",{className:"text-[#172554]",children:"Show"}),e.jsx(V,{placeholder:"All"})," "]}),e.jsxs(R,{children:[e.jsx(c,{value:"all",children:"All"}),e.jsx(c,{value:"10",children:"10"}),e.jsx(c,{value:"20",children:"20"}),e.jsx(c,{value:"30",children:"30"}),e.jsx(c,{value:"40",children:"40"}),e.jsx(c,{value:"50",children:"50"})]})]}),e.jsx(w,{type:"text",placeholder:"Search",className:"w-52 md:w-full",value:l,onChange:k})]}),e.jsx("div",{className:"fade-in-left",children:e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(E,{children:[e.jsx(a,{children:"#"}),e.jsx(a,{children:"Fullname"}),e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Email address"}),e.jsx(a,{children:"Contact number"}),e.jsx(a,{children:"Date Approved"}),e.jsx(a,{children:"Status"}),e.jsx(a,{className:"text-right",children:"Action"})]})}),e.jsx(oe,{children:i.length>0?i.map((s,F)=>{var T,L,u,p,f,j,b,N,_;return e.jsxs(E,{children:[e.jsx(o,{className:"font-medium border border-[#bfdbfe]",children:F+1}),e.jsxs(o,{className:"border border-[#bfdbfe] uppercase",children:[s.personal_info.first_name," ",s.personal_info.middle_name," ",s.personal_info.last_name," ",s.personal_info.extension_name]}),e.jsx(o,{className:"font-medium border border-[#bfdbfe]",children:((T=s==null?void 0:s.user)==null?void 0:T.role)===1?e.jsx("span",{className:"inline-flex unlicenseds-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-blue-700/10 ring-inset",children:"Agent"}):((L=s==null?void 0:s.user)==null?void 0:L.role)===2?e.jsx("span",{className:"inline-flex unlicenseds-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-green-600/20 ring-inset",children:"Broker"}):(u=s==null?void 0:s.user)==null?void 0:u.role}),e.jsx(o,{className:"border border-[#bfdbfe]",children:s==null?void 0:s.user.email}),e.jsx(o,{className:"border border-[#bfdbfe]",children:s==null?void 0:s.personal_info.phone}),e.jsx(o,{className:"border border-[#bfdbfe]",children:ae(s==null?void 0:s.user.updated_at)}),e.jsx(o,{className:"border border-[#bfdbfe]",children:(()=>{var U;const n=(U=s==null?void 0:s.prc_liscence_number)==null?void 0:U.trim();return!n||n.toUpperCase()==="N/A"||n.toUpperCase()==="NA"||n.length<4||n.toLowerCase()==="n/a"||n.toLowerCase()==="na"||n.toLowerCase()===""?e.jsxs(I,{className:"bg-red-500 hover:bg-red-500 gap-1",children:[e.jsx(y,{icon:g}),"Unlicensed"]}):e.jsxs(I,{className:"bg-green-500 hover:bg-green-500 gap-1",children:[e.jsx(y,{icon:ee})," Licensed"]})})()}),e.jsx(o,{className:"text-right border border-[#bfdbfe]",children:e.jsxs("div",{className:"flex flex-row gap-1 justify-end",children:[e.jsxs(H,{children:[e.jsx(M,{children:e.jsx(B,{className:"w-8 h-8 rounded-md",children:e.jsx(y,{icon:se,className:"text-[#eff6ff]"})})}),e.jsx(z,{className:"md:max-w-[400px]",children:e.jsxs(Q,{children:[e.jsx(X,{className:"text-start",children:"Agent and Broker Details"}),e.jsx(G,{children:e.jsxs("div",{className:"flex flex-col gap-4 mt-5 mb-5",children:[e.jsxs("div",{className:"border-b pb-2 mb-4 text-start",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Personal Details"}),e.jsxs("p",{children:["Account number: ",s==null?void 0:s.user.acct_number]}),e.jsxs("p",{children:["Name: ",(p=s==null?void 0:s.personal_info)==null?void 0:p.first_name," ",(f=s==null?void 0:s.personal_info)==null?void 0:f.middle_name," ",(j=s==null?void 0:s.personal_info)==null?void 0:j.last_name]}),e.jsxs("p",{children:["Email: ",(b=s==null?void 0:s.user)==null?void 0:b.email]}),e.jsxs("p",{children:["Username: ",(N=s==null?void 0:s.user)==null?void 0:N.username]}),e.jsxs("p",{children:["Phone: ",(_=s==null?void 0:s.personal_info)==null?void 0:_.phone]}),e.jsxs("p",{children:["Gender: ",s.personal_info.gender.charAt(0).toUpperCase()+s.personal_info.gender.slice(1)]}),e.jsxs("p",{children:["Complete Address: ",s.personal_info.complete_address]}),e.jsxs("p",{children:["Status: ",s.user.status===0?"Approved":s.user.status===1?"Pending":"Decline"]})]}),e.jsxs("div",{className:"text-start",children:[e.jsx("h2",{className:"text-lg font-bold ",children:"Identity Information"}),e.jsxs("p",{children:["PRC License Number: ",(s==null?void 0:s.prc_liscence_number)||"N/A"]}),e.jsxs("p",{children:["DHSUD Registration Number: ",(s==null?void 0:s.dhsud_registration_number)||"N/A"]}),e.jsxs("p",{children:["Type: ",(s==null?void 0:s.user.role)===1?"Agent":(s==null?void 0:s.user.role)===2?"Broker":"N/A"]}),e.jsxs("p",{children:["Validity Date: ",ce((s==null?void 0:s.validation_date)||"N/A")]})]})]})}),e.jsx(ie,{asChild:!0,children:e.jsx(B,{className:"bg-red-500 hover:bg-red-400",children:"Close"})})]})})]}),e.jsx(ne,{agent:s,agentList:A})]})})]},s.id)}):e.jsx(E,{children:e.jsx(o,{colSpan:9,className:"text-center border border-[#bfdbfe]",children:"No data available"})})})]})}),e.jsx("div",{className:"flex flex-row justify-end mt-3",children:e.jsx("div",{children:e.jsxs("p",{className:"text-[#172554] text-sm w-full",children:["Showing 1 to ",x==="all"?d.length:x," of ",d.length," entries"]})})})]})}export{je as default};
